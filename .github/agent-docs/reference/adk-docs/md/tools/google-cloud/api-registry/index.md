Skip to content 

[ ](../../.. "Agent Development Kit")

[ Agent Development Kit ](../../.. "Agent Development Kit")

Cloud API Registry 

Initializing search 




[ adk-python  ](https://github.com/google/adk-python "adk-python") [ adk-js  ](https://github.com/google/adk-js "adk-js") [ adk-go  ](https://github.com/google/adk-go "adk-go") [ adk-java  ](https://github.com/google/adk-java "adk-java")

[ adk-python  ](https://github.com/google/adk-python "adk-python") [ adk-js  ](https://github.com/google/adk-js "adk-js") [ adk-go  ](https://github.com/google/adk-go "adk-go") [ adk-java  ](https://github.com/google/adk-java "adk-java")

  * [ Home  ](../../..)

Home 
  * Build Agents  Build Agents 
    * [ Get Started  ](../../../get-started/)

Get Started 
      * [ Python  ](../../../get-started/python/)
      * [ TypeScript  ](../../../get-started/typescript/)
      * [ Go  ](../../../get-started/go/)
      * [ Java  ](../../../get-started/java/)
    * [ Build your Agent  ](../../../tutorials/)

Build your Agent 
      * [ Multi-tool agent  ](../../../get-started/quickstart/)
      * [ Agent team  ](../../../tutorials/agent-team/)
      * [ Streaming agent  ](../../../get-started/streaming/)

Streaming agent 
        * [ Python  ](../../../get-started/streaming/quickstart-streaming/)
        * [ Java  ](../../../get-started/streaming/quickstart-streaming-java/)
      * [ Visual Builder  ](../../../visual-builder/)
      * [ Coding with AI  ](../../../tutorials/coding-with-ai/)
      * [ Advanced setup  ](../../../get-started/installation/)
    * [ Agents  ](../../../agents/)

Agents 
      * [ LLM agents  ](../../../agents/llm-agents/)
      * [ Workflow agents  ](../../../agents/workflow-agents/)

Workflow agents 
        * [ Sequential agents  ](../../../agents/workflow-agents/sequential-agents/)
        * [ Loop agents  ](../../../agents/workflow-agents/loop-agents/)
        * [ Parallel agents  ](../../../agents/workflow-agents/parallel-agents/)
      * [ Custom agents  ](../../../agents/custom-agents/)
      * [ Multi-agent systems  ](../../../agents/multi-agents/)
      * [ Agent Config  ](../../../agents/config/)
      * [ Models & Authentication  ](../../../agents/models/)
    * [ Tools for Agents  ](../../)

Tools for Agents 
      * [ Gemini API tools  ](../../gemini-api/)

Gemini API tools 
        * [ Code Execution  ](../../gemini-api/code-execution/)
        * [ Computer use  ](../../gemini-api/computer-use/)
        * [ Google Search  ](../../gemini-api/google-search/)
      * [ Google Cloud tools  ](../)

Google Cloud tools 
        * [ Apigee API Hub  ](../apigee-api-hub/)
        * [ Application Integration  ](../application-integration/)
        * [ BigQuery  ](../bigquery/)
        * [ Bigtable  ](../bigtable/)
        * Cloud API Registry  [ Cloud API Registry  ](./) Table of contents 
          * Prerequisites 
          * Use with agent 
          * Authentication and access 
          * Configuration 
          * Additional resources 
        * [ Code Execution with Agent Engine  ](../code-exec-agent-engine/)
        * [ GKE Code Executor  ](../gke-code-executor/)
        * [ MCP Toolbox for Databases  ](../mcp-toolbox-for-databases/)
        * [ RAG Engine  ](../vertex-ai-rag-engine/)
        * [ Spanner  ](../spanner/)
        * [ Vertex AI Search  ](../vertex-ai-search/)
      * [ Third-party tools  ](../../third-party/)

Third-party tools 
        * [ Atlassian  ](../../third-party/atlassian/)
        * [ GitHub  ](../../third-party/github/)
        * [ GitLab  ](../../third-party/gitlab/)
        * [ Hugging Face  ](../../third-party/hugging-face/)
        * [ Linear  ](../../third-party/linear/)
        * [ n8n  ](../../third-party/n8n/)
        * [ Notion  ](../../third-party/notion/)
        * [ PayPal  ](../../third-party/paypal/)
        * [ Qdrant  ](../../third-party/qdrant/)
        * [ Agentic UI (AG-UI)  ](../../third-party/ag-ui/)
      * [ Tool limitations  ](../../limitations/)
    * [ Custom Tools  ](../../../tools-custom/)

Custom Tools 
      * Function tools  Function tools 
        * [ Overview  ](../../../tools-custom/function-tools/)
        * [ Tool performance  ](../../../tools-custom/performance/)
        * [ Action confirmations  ](../../../tools-custom/confirmation/)
      * [ MCP tools  ](../../../tools-custom/mcp-tools/)
      * [ OpenAPI tools  ](../../../tools-custom/openapi-tools/)
      * [ Authentication  ](../../../tools-custom/authentication/)
  * Run Agents  Run Agents 
    * [ Agent Runtime  ](../../../runtime/)

Agent Runtime 
      * [ Runtime Config  ](../../../runtime/runconfig/)
      * [ API Server  ](../../../runtime/api-server/)
      * [ Resume Agents  ](../../../runtime/resume/)
    * [ Deployment  ](../../../deploy/)

Deployment 
      * [ Agent Engine  ](../../../deploy/agent-engine/)

Agent Engine 
        * [ Standard deployment  ](../../../deploy/agent-engine/deploy/)
        * [ Agent Starter Pack  ](../../../deploy/agent-engine/asp/)
        * [ Test deployed agents  ](../../../deploy/agent-engine/test/)
      * [ Cloud Run  ](../../../deploy/cloud-run/)
      * [ GKE  ](../../../deploy/gke/)
    * Observability  Observability 
      * [ Logging  ](../../../observability/logging/)
      * [ Cloud Trace  ](../../../observability/cloud-trace/)
      * [ BigQuery Agent Analytics  ](../../../observability/bigquery-agent-analytics/)
      * [ AgentOps  ](../../../observability/agentops/)
      * [ Arize AX  ](../../../observability/arize-ax/)
      * [ Freeplay  ](../../../observability/freeplay/)
      * [ MLflow  ](../../../observability/mlflow/)
      * [ Monocle  ](../../../observability/monocle/)
      * [ Phoenix  ](../../../observability/phoenix/)
      * [ W&B; Weave  ](../../../observability/weave/)
    * [ Evaluation  ](../../../evaluate/)

Evaluation 
      * [ Criteria  ](../../../evaluate/criteria/)
      * [ User Simulation  ](../../../evaluate/user-sim/)
    * [ Safety and Security  ](../../../safety/)

Safety and Security 
  * Components  Components 
    * [ Technical Overview  ](../../../get-started/about/)
    * [ Context  ](../../../context/)

Context 
      * [ Context caching  ](../../../context/caching/)
      * [ Context compression  ](../../../context/compaction/)
    * [ Sessions & Memory  ](../../../sessions/)

Sessions & Memory 
      * Sessions  Sessions 
        * [ Overview  ](../../../sessions/session/)
        * [ Rewind sessions  ](../../../sessions/rewind/)
      * [ State  ](../../../sessions/state/)
      * [ Memory  ](../../../sessions/memory/)
      * [ Vertex AI Express Mode  ](../../../sessions/express-mode/)
    * [ Callbacks  ](../../../callbacks/)

Callbacks 
      * [ Types of callbacks  ](../../../callbacks/types-of-callbacks/)
      * [ Callback patterns  ](../../../callbacks/design-patterns-and-best-practices/)
    * [ Artifacts  ](../../../artifacts/)

Artifacts 
    * [ Events  ](../../../events/)

Events 
    * [ Apps  ](../../../apps/)

Apps 
    * [ Plugins  ](../../../plugins/)

Plugins 
      * [ Reflect and retry  ](../../../plugins/reflect-and-retry/)
    * [ MCP  ](../../../mcp/)

MCP 
    * [ A2A Protocol  ](../../../a2a/)

A2A Protocol 
      * [ Introduction to A2A  ](../../../a2a/intro/)
      * A2A Quickstart (Exposing)  A2A Quickstart (Exposing) 
        * [ Python  ](../../../a2a/quickstart-exposing/)
        * [ Go  ](../../../a2a/quickstart-exposing-go/)
      * A2A Quickstart (Consuming)  A2A Quickstart (Consuming) 
        * [ Python  ](../../../a2a/quickstart-consuming/)
        * [ Go  ](../../../a2a/quickstart-consuming-go/)
    * [ Bidi-streaming (live)  ](../../../streaming/)

Bidi-streaming (live) 
      * Bidi-streaming development guide series  Bidi-streaming development guide series 
        * [ Part 1. Intro to streaming  ](../../../streaming/dev-guide/part1/)
        * [ Part 2. Sending messages  ](../../../streaming/dev-guide/part2/)
        * [ Part 3. Event handling  ](../../../streaming/dev-guide/part3/)
        * [ Part 4. Run configuration  ](../../../streaming/dev-guide/part4/)
        * [ Part 5. Audio, Images, and Video  ](../../../streaming/dev-guide/part5/)
      * [ Streaming Tools  ](../../../streaming/streaming-tools/)
      * [ Configuring Bidi-streaming behavior  ](../../../streaming/configuration/)
    * Grounding  Grounding 
      * [ Understanding Google Search Grounding  ](../../../grounding/google_search_grounding/)
      * [ Understanding Vertex AI Search Grounding  ](../../../grounding/vertex_ai_search_grounding/)
  * Reference  Reference 
    * [ Release Notes  ](../../../release-notes/)
    * [ API Reference  ](../../../api-reference/)

API Reference 
      * [ Python ADK  ](../../../api-reference/python/)
      * [ Typescript ADK  ](../../../api-reference/typescript/)
      * [ Go ADK  ](https://pkg.go.dev/google.golang.org/adk)
      * [ Java ADK  ](../../../api-reference/java/)
      * [ CLI Reference  ](../../../api-reference/cli/)
      * [ Agent Config Reference  ](../../../api-reference/agentconfig/)
      * [ REST API  ](../../../api-reference/rest/)
    * [ Community Resources  ](../../../community/)
    * [ Contributing Guide  ](../../../contributing-guide/)



Table of contents 

  * Prerequisites 
  * Use with agent 
  * Authentication and access 
  * Configuration 
  * Additional resources 



  1. [ Build Agents  ](../../../get-started/)
  2. [ Tools for Agents  ](../../)
  3. [ Google Cloud tools  ](../)

[ ](https://github.com/google/adk-docs/edit/main/docs/tools/google-cloud/api-registry.md "Edit this page") [ ](https://github.com/google/adk-docs/raw/main/docs/tools/google-cloud/api-registry.md "View source of this page")

# Connect MCP tools from Cloud API Registry¶

Supported in ADKPython v1.20.0Preview

The Google Cloud API Registry connector tool for Agent Development Kit (ADK) lets you access a wide range of Google Cloud services for your agents as Model Context Protocol (MCP) servers through the [Google Cloud API Registry](https://docs.cloud.google.com/api-registry/docs/overview). You can configure this tool to connect your agent to your Google Cloud projects and dynamically access Cloud services enabled for that project.

Preview release

The Google Cloud API Registry feature is a Preview release. For more information, see the [launch stage descriptions](https://cloud.google.com/products#product-launch-stages).

## Prerequisites¶

Before using the API Registry with your agent, you need to ensure the following:

  * **Google Cloud project:** Configure your agent to access AI models using an existing Google Cloud project.

  * **API Registry access:** The environment where your agent runs needs Google Cloud [Application Default Credentials](https://docs.cloud.google.com/docs/authentication/provide-credentials-adc) with the `apiregistry.viewer` role to list available MCP servers.

  * **Cloud APIs:** In your Google Cloud project, enable the _cloudapiregistry.googleapis.com_ and _apihub.googleapis.com_ Google Cloud APIs.

  * **MCP Server and Tool access:** Make sure you enable the MCP Servers in the API Registry for the Google Cloud services in your Cloud Project that you want access with your agent. You can enable this in the Cloud Console or use a gcloud command such as: `gcloud beta api-registry mcp enable bigquery.googleapis.com --project={PROJECT_ID}`. The credentials used by the agent must have permissions to access the MCP server and the underlying services used by the tools. For example, to use BigQuery tools, the service account needs BigQuery IAM roles like `bigquery.dataViewer` and `bigquery.jobUser`. For more information about required permissions, see Authentication and access.




You can check what MCP servers are enabled with API Registry using the follwing gcloud command:
    
    
    gcloud beta api-registry mcp servers list --project={PROJECT_ID}.
    

## Use with agent¶

When configuring the API Registry connector tool with an agent, you first initialize the **_ApiRegistry_** class to establish a connection with Cloud services, and then use the `get_toolset()` function to retrieve a toolset for a specific MCP server registered in the API Registry. The following code example demonstrates how to create an agent that uses tools from an MCP server listed in API Registry. This agent is designed to interact with BigQuery:
    
    
    import os
    from google.adk.agents.llm_agent import LlmAgent
    from google.adk.tools.api_registry import ApiRegistry
    
    # Configure with your Google Cloud Project ID and registered MCP server name
    PROJECT_ID = "your-google-cloud-project-id"
    MCP_SERVER_NAME = "projects/your-google-cloud-project-id/locations/global/mcpServers/your-mcp-server-name"
    
    # Example header provider for BigQuery, a project header is required.
    def header_provider(context):
        return {"x-goog-user-project": PROJECT_ID}
    
    # Initialize ApiRegistry
    api_registry = ApiRegistry(
        api_registry_project_id=PROJECT_ID,
        header_provider=header_provider
    )
    
    # Get the toolset for the specific MCP server
    registry_tools = api_registry.get_toolset(
        mcp_server_name=MCP_SERVER_NAME,
        # Optionally filter tools:
        #tool_filter=["list_datasets", "run_query"]
    )
    
    # Create an agent with the tools
    root_agent = LlmAgent(
        model="gemini-1.5-flash", # Or your preferred model
        name="bigquery_assistant",
        instruction="""
    Help user access their BigQuery data using the available tools.
        """,
        tools=[registry_tools],
    )
    

For the complete code for this example, see the [api_registry_agent](https://github.com/google/adk-python/tree/main/contributing/samples/api_registry_agent/) sample. For information on the configuration options, see Configuration. For information on the authentication for this tool, see Authentication and access.

## Authentication and access¶

Using the API Registry with your agent requires authentication for the services the agent accesses. By default the tool uses Google Cloud [Application Default Credentials](https://docs.cloud.google.com/docs/authentication/provide-credentials-adc) for authentication. When using this tool make sure your agent has the following permissions and access:

  * **API Registry access:** The `ApiRegistry` class uses Application Default Credentials (`google.auth.default()`) to authenticate requests to the Google Cloud API Registry to list the available MCP servers. Ensure the environment where the agent runs has credentials with the necessary permissions to view the API Registry resources, such as `apiregistry.viewer`.

  * **MCP Server and Tool access:** The `McpToolset` returned by `get_toolset` also uses the Google Cloud Application Default Credentials by default to authenticate calls to the actual MCP server endpoint. The credentials used must have the necessary permissions for both:

    1. Accessing the MCP server itself.
    2. Utilizing the underlying services and resources that the tools interact with.
  * **MCP Tool user role:** Allow the account used by your agent to call MCP tools through the API registry by granting the MCP tool user role: `gcloud projects add-iam-policy-binding {PROJECT_ID} --member={member} --role="roles/mcp.toolUser"`




For example, when using MCP server tools that interact with BigQuery, the account associated with the credentials, such as a service account, must be granted appropriate BigQuery IAM roles, such as `bigquery.dataViewer` or `bigquery.jobUser`, within your Google Cloud project to access datasets and run queries. In the case of the bigquery MCP server, a `"x-goog-user-project": PROJECT_ID` header is required to use its tools Additional headers for authentication or project context can be injected via the `header_provider` argument in the `ApiRegistry` constructor.

## Configuration¶

The **_APIRegistry_** object has the following configuration options:

  * **`api_registry_project_id`** (str): The Google Cloud Project ID where the API Registry is located.

  * **`location`** (str, optional): The location of the API Registry resources. Defaults to `"global"`.

  * **`header_provider`** (Callable, optional): A function that takes the call context and returns a dictionary of additional HTTP headers to be sent with requests to the MCP server. This is often used for dynamic authentication or project-specific headers.




The `get_toolset()` function has the following configuration options:

  * **`mcp_server_name`** (str): The full name of the registered MCP server from which to load tools, for example: `projects/my-project/locations/global/mcpServers/my-server`.

  * **`tool_filter`** (Union[ToolPredicate, List[str]], optional): Specifies which tools to include in the toolset.

    * If a list of strings, only tools with names in the list are included.
    * If a `ToolPredicate` function, the function is called for each tool, and only tools for which it returns `True` are included.
    * If `None`, all tools from the MCP server are included.
  * **`tool_name_prefix`** (str, optional): A prefix to add to the name of each tool in the resulting toolset.




## Additional resources¶

  * [api_registry_agent](https://github.com/google/adk-python/tree/main/contributing/samples/api_registry_agent/) ADK code sample
  * [Google Cloud API Registry](https://docs.cloud.google.com/api-registry/docs/overview) documentation



Back to top  [ Previous  Bigtable  ](../bigtable/) [ Next  Code Execution with Agent Engine  ](../code-exec-agent-engine/)

Copyright Google 2025  |  [Terms](//policies.google.com/terms)  |  [Privacy](//policies.google.com/privacy)  |  Manage cookies

Made with [ Material for MkDocs ](https://squidfunk.github.io/mkdocs-material/)

#### Cookie consent

We use cookies to recognize repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find the information they need. With your consent, you're helping us to make our documentation better.

  * Google Analytics 
  * GitHub 



Accept Manage settings

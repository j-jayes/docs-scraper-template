Skip to content 

[ ](../../.. "Agent Development Kit")

[ Agent Development Kit ](../../.. "Agent Development Kit")

Spanner 

Initializing search 




[ adk-python  ](https://github.com/google/adk-python "adk-python") [ adk-js  ](https://github.com/google/adk-js "adk-js") [ adk-go  ](https://github.com/google/adk-go "adk-go") [ adk-java  ](https://github.com/google/adk-java "adk-java")

[ adk-python  ](https://github.com/google/adk-python "adk-python") [ adk-js  ](https://github.com/google/adk-js "adk-js") [ adk-go  ](https://github.com/google/adk-go "adk-go") [ adk-java  ](https://github.com/google/adk-java "adk-java")

  * [ Home  ](../../..)

Home 
  * Build Agents  Build Agents 
    * [ Get Started  ](../../../get-started/)

Get Started 
      * [ Python  ](../../../get-started/python/)
      * [ TypeScript  ](../../../get-started/typescript/)
      * [ Go  ](../../../get-started/go/)
      * [ Java  ](../../../get-started/java/)
    * [ Build your Agent  ](../../../tutorials/)

Build your Agent 
      * [ Multi-tool agent  ](../../../get-started/quickstart/)
      * [ Agent team  ](../../../tutorials/agent-team/)
      * [ Streaming agent  ](../../../get-started/streaming/)

Streaming agent 
        * [ Python  ](../../../get-started/streaming/quickstart-streaming/)
        * [ Java  ](../../../get-started/streaming/quickstart-streaming-java/)
      * [ Visual Builder  ](../../../visual-builder/)
      * [ Coding with AI  ](../../../tutorials/coding-with-ai/)
      * [ Advanced setup  ](../../../get-started/installation/)
    * [ Agents  ](../../../agents/)

Agents 
      * [ LLM agents  ](../../../agents/llm-agents/)
      * [ Workflow agents  ](../../../agents/workflow-agents/)

Workflow agents 
        * [ Sequential agents  ](../../../agents/workflow-agents/sequential-agents/)
        * [ Loop agents  ](../../../agents/workflow-agents/loop-agents/)
        * [ Parallel agents  ](../../../agents/workflow-agents/parallel-agents/)
      * [ Custom agents  ](../../../agents/custom-agents/)
      * [ Multi-agent systems  ](../../../agents/multi-agents/)
      * [ Agent Config  ](../../../agents/config/)
      * [ Models & Authentication  ](../../../agents/models/)
    * [ Tools for Agents  ](../../)

Tools for Agents 
      * [ Gemini API tools  ](../../gemini-api/)

Gemini API tools 
        * [ Code Execution  ](../../gemini-api/code-execution/)
        * [ Computer use  ](../../gemini-api/computer-use/)
        * [ Google Search  ](../../gemini-api/google-search/)
      * [ Google Cloud tools  ](../)

Google Cloud tools 
        * [ Apigee API Hub  ](../apigee-api-hub/)
        * [ Application Integration  ](../application-integration/)
        * [ BigQuery  ](../bigquery/)
        * [ Bigtable  ](../bigtable/)
        * [ Cloud API Registry  ](../api-registry/)
        * [ Code Execution with Agent Engine  ](../code-exec-agent-engine/)
        * [ GKE Code Executor  ](../gke-code-executor/)
        * [ MCP Toolbox for Databases  ](../mcp-toolbox-for-databases/)
        * [ RAG Engine  ](../vertex-ai-rag-engine/)
        * [ Spanner  ](./)
        * [ Vertex AI Search  ](../vertex-ai-search/)
      * [ Third-party tools  ](../../third-party/)

Third-party tools 
        * [ Atlassian  ](../../third-party/atlassian/)
        * [ GitHub  ](../../third-party/github/)
        * [ GitLab  ](../../third-party/gitlab/)
        * [ Hugging Face  ](../../third-party/hugging-face/)
        * [ Linear  ](../../third-party/linear/)
        * [ n8n  ](../../third-party/n8n/)
        * [ Notion  ](../../third-party/notion/)
        * [ PayPal  ](../../third-party/paypal/)
        * [ Qdrant  ](../../third-party/qdrant/)
        * [ Agentic UI (AG-UI)  ](../../third-party/ag-ui/)
      * [ Tool limitations  ](../../limitations/)
    * [ Custom Tools  ](../../../tools-custom/)

Custom Tools 
      * Function tools  Function tools 
        * [ Overview  ](../../../tools-custom/function-tools/)
        * [ Tool performance  ](../../../tools-custom/performance/)
        * [ Action confirmations  ](../../../tools-custom/confirmation/)
      * [ MCP tools  ](../../../tools-custom/mcp-tools/)
      * [ OpenAPI tools  ](../../../tools-custom/openapi-tools/)
      * [ Authentication  ](../../../tools-custom/authentication/)
  * Run Agents  Run Agents 
    * [ Agent Runtime  ](../../../runtime/)

Agent Runtime 
      * [ Runtime Config  ](../../../runtime/runconfig/)
      * [ API Server  ](../../../runtime/api-server/)
      * [ Resume Agents  ](../../../runtime/resume/)
    * [ Deployment  ](../../../deploy/)

Deployment 
      * [ Agent Engine  ](../../../deploy/agent-engine/)

Agent Engine 
        * [ Standard deployment  ](../../../deploy/agent-engine/deploy/)
        * [ Agent Starter Pack  ](../../../deploy/agent-engine/asp/)
        * [ Test deployed agents  ](../../../deploy/agent-engine/test/)
      * [ Cloud Run  ](../../../deploy/cloud-run/)
      * [ GKE  ](../../../deploy/gke/)
    * Observability  Observability 
      * [ Logging  ](../../../observability/logging/)
      * [ Cloud Trace  ](../../../observability/cloud-trace/)
      * [ BigQuery Agent Analytics  ](../../../observability/bigquery-agent-analytics/)
      * [ AgentOps  ](../../../observability/agentops/)
      * [ Arize AX  ](../../../observability/arize-ax/)
      * [ Freeplay  ](../../../observability/freeplay/)
      * [ MLflow  ](../../../observability/mlflow/)
      * [ Monocle  ](../../../observability/monocle/)
      * [ Phoenix  ](../../../observability/phoenix/)
      * [ W&B; Weave  ](../../../observability/weave/)
    * [ Evaluation  ](../../../evaluate/)

Evaluation 
      * [ Criteria  ](../../../evaluate/criteria/)
      * [ User Simulation  ](../../../evaluate/user-sim/)
    * [ Safety and Security  ](../../../safety/)

Safety and Security 
  * Components  Components 
    * [ Technical Overview  ](../../../get-started/about/)
    * [ Context  ](../../../context/)

Context 
      * [ Context caching  ](../../../context/caching/)
      * [ Context compression  ](../../../context/compaction/)
    * [ Sessions & Memory  ](../../../sessions/)

Sessions & Memory 
      * Sessions  Sessions 
        * [ Overview  ](../../../sessions/session/)
        * [ Rewind sessions  ](../../../sessions/rewind/)
      * [ State  ](../../../sessions/state/)
      * [ Memory  ](../../../sessions/memory/)
      * [ Vertex AI Express Mode  ](../../../sessions/express-mode/)
    * [ Callbacks  ](../../../callbacks/)

Callbacks 
      * [ Types of callbacks  ](../../../callbacks/types-of-callbacks/)
      * [ Callback patterns  ](../../../callbacks/design-patterns-and-best-practices/)
    * [ Artifacts  ](../../../artifacts/)

Artifacts 
    * [ Events  ](../../../events/)

Events 
    * [ Apps  ](../../../apps/)

Apps 
    * [ Plugins  ](../../../plugins/)

Plugins 
      * [ Reflect and retry  ](../../../plugins/reflect-and-retry/)
    * [ MCP  ](../../../mcp/)

MCP 
    * [ A2A Protocol  ](../../../a2a/)

A2A Protocol 
      * [ Introduction to A2A  ](../../../a2a/intro/)
      * A2A Quickstart (Exposing)  A2A Quickstart (Exposing) 
        * [ Python  ](../../../a2a/quickstart-exposing/)
        * [ Go  ](../../../a2a/quickstart-exposing-go/)
      * A2A Quickstart (Consuming)  A2A Quickstart (Consuming) 
        * [ Python  ](../../../a2a/quickstart-consuming/)
        * [ Go  ](../../../a2a/quickstart-consuming-go/)
    * [ Bidi-streaming (live)  ](../../../streaming/)

Bidi-streaming (live) 
      * Bidi-streaming development guide series  Bidi-streaming development guide series 
        * [ Part 1. Intro to streaming  ](../../../streaming/dev-guide/part1/)
        * [ Part 2. Sending messages  ](../../../streaming/dev-guide/part2/)
        * [ Part 3. Event handling  ](../../../streaming/dev-guide/part3/)
        * [ Part 4. Run configuration  ](../../../streaming/dev-guide/part4/)
        * [ Part 5. Audio, Images, and Video  ](../../../streaming/dev-guide/part5/)
      * [ Streaming Tools  ](../../../streaming/streaming-tools/)
      * [ Configuring Bidi-streaming behavior  ](../../../streaming/configuration/)
    * Grounding  Grounding 
      * [ Understanding Google Search Grounding  ](../../../grounding/google_search_grounding/)
      * [ Understanding Vertex AI Search Grounding  ](../../../grounding/vertex_ai_search_grounding/)
  * Reference  Reference 
    * [ Release Notes  ](../../../release-notes/)
    * [ API Reference  ](../../../api-reference/)

API Reference 
      * [ Python ADK  ](../../../api-reference/python/)
      * [ Typescript ADK  ](../../../api-reference/typescript/)
      * [ Go ADK  ](https://pkg.go.dev/google.golang.org/adk)
      * [ Java ADK  ](../../../api-reference/java/)
      * [ CLI Reference  ](../../../api-reference/cli/)
      * [ Agent Config Reference  ](../../../api-reference/agentconfig/)
      * [ REST API  ](../../../api-reference/rest/)
    * [ Community Resources  ](../../../community/)
    * [ Contributing Guide  ](../../../contributing-guide/)



  1. [ Build Agents  ](../../../get-started/)
  2. [ Tools for Agents  ](../../)
  3. [ Google Cloud tools  ](../)

[ ](https://github.com/google/adk-docs/edit/main/docs/tools/google-cloud/spanner.md "Edit this page") [ ](https://github.com/google/adk-docs/raw/main/docs/tools/google-cloud/spanner.md "View source of this page")

# Spanner database tool for ADKÂ¶

Supported in ADKPython v1.11.0

These are a set of tools aimed to provide integration with Spanner, namely:

  * **`list_table_names`** : Fetches table names present in a GCP Spanner database.
  * **`list_table_indexes`** : Fetches table indexes present in a GCP Spanner database.
  * **`list_table_index_columns`** : Fetches table index columns present in a GCP Spanner database.
  * **`list_named_schemas`** : Fetches named schema for a Spanner database.
  * **`get_table_schema`** : Fetches Spanner database table schema and metadata information.
  * **`execute_sql`** : Runs a SQL query in Spanner database and fetch the result.
  * **`similarity_search`** : Similarity search in Spanner using a text query.



They are packaged in the toolset `SpannerToolset`.
    
    
    # Copyright 2025 Google LLC
    #
    # Licensed under the Apache License, Version 2.0 (the "License");
    # you may not use this file except in compliance with the License.
    # You may obtain a copy of the License at
    #
    #     http://www.apache.org/licenses/LICENSE-2.0
    #
    # Unless required by applicable law or agreed to in writing, software
    # distributed under the License is distributed on an "AS IS" BASIS,
    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    # See the License for the specific language governing permissions and
    # limitations under the License.
    
    import asyncio
    
    from google.adk.agents import Agent
    from google.adk.runners import Runner
    from google.adk.sessions import InMemorySessionService
    # from google.adk.sessions import DatabaseSessionService
    from google.adk.tools.google_tool import GoogleTool
    from google.adk.tools.spanner import query_tool
    from google.adk.tools.spanner.settings import SpannerToolSettings
    from google.adk.tools.spanner.settings import Capabilities
    from google.adk.tools.spanner.spanner_credentials import SpannerCredentialsConfig
    from google.adk.tools.spanner.spanner_toolset import SpannerToolset
    from google.genai import types
    from google.adk.tools.tool_context import ToolContext
    import google.auth
    from google.auth.credentials import Credentials
    
    # Define constants for this example agent
    AGENT_NAME = "spanner_agent"
    APP_NAME = "spanner_app"
    USER_ID = "user1234"
    SESSION_ID = "1234"
    GEMINI_MODEL = "gemini-2.5-flash"
    
    # Define Spanner tool config with read capability set to allowed.
    tool_settings = SpannerToolSettings(capabilities=[Capabilities.DATA_READ])
    
    # Define a credentials config - in this example we are using application default
    # credentials
    # https://cloud.google.com/docs/authentication/provide-credentials-adc
    application_default_credentials, _ = google.auth.default()
    credentials_config = SpannerCredentialsConfig(
        credentials=application_default_credentials
    )
    
    # Instantiate a Spanner toolset
    spanner_toolset = SpannerToolset(
        credentials_config=credentials_config, spanner_tool_settings=tool_settings
    )
    
    # Optional
    # Create a wrapped function tool for the agent on top of the built-in
    # `execute_sql` tool in the Spanner toolset.
    # For example, this customized tool can perform a dynamically-built query.
    def count_rows_tool(
        table_name: str,
        credentials: Credentials,  # GoogleTool handles `credentials`
        settings: SpannerToolSettings,  # GoogleTool handles `settings`
        tool_context: ToolContext,  # GoogleTool handles `tool_context`
    ):
      """Counts the total number of rows for a specified table.
    
      Args:
        table_name: The name of the table for which to count rows.
    
      Returns:
          The total number of rows in the table.
      """
    
      # Replace the following settings for a specific Spanner database.
      PROJECT_ID = "<PROJECT_ID>"
      INSTANCE_ID = "<INSTANCE_ID>"
      DATABASE_ID = "<DATABASE_ID>"
    
      query = f"""
      SELECT count(*) FROM {table_name}
        """
    
      return query_tool.execute_sql(
          project_id=PROJECT_ID,
          instance_id=INSTANCE_ID,
          database_id=DATABASE_ID,
          query=query,
          credentials=credentials,
          settings=settings,
          tool_context=tool_context,
      )
    
    # Agent Definition
    spanner_agent = Agent(
        model=GEMINI_MODEL,
        name=AGENT_NAME,
        description=(
            "Agent to answer questions about Spanner database and execute SQL queries."
        ),
        instruction="""\
            You are a data assistant agent with access to several Spanner tools.
            Make use of those tools to answer the user's questions.
        """,
        tools=[
            spanner_toolset,
            # Add customized Spanner tool based on the built-in Spanner toolset.
            GoogleTool(
                func=count_rows_tool,
                credentials_config=credentials_config,
                tool_settings=tool_settings,
            ),
        ],
    )
    
    
    # Session and Runner
    session_service = InMemorySessionService()
    
    # Optionally, Spanner can be used as the Database Session Service for production.
    # Note that it's suggested to use a dedicated instance/database for storing sessions.
    # session_service_spanner_db_url = "spanner+spanner:///projects/PROJECT_ID/instances/INSTANCE_ID/databases/my-adk-session"
    # session_service = DatabaseSessionService(db_url=session_service_spanner_db_url)
    
    session = asyncio.run(
        session_service.create_session(
            app_name=APP_NAME, user_id=USER_ID, session_id=SESSION_ID
        )
    )
    runner = Runner(
        agent=spanner_agent, app_name=APP_NAME, session_service=session_service
    )
    
    
    # Agent Interaction
    def call_agent(query):
        """
        Helper function to call the agent with a query.
        """
        content = types.Content(role="user", parts=[types.Part(text=query)])
        events = runner.run(user_id=USER_ID, session_id=SESSION_ID, new_message=content)
    
        print("USER:", query)
        for event in events:
            if event.is_final_response():
                final_response = event.content.parts[0].text
                print("AGENT:", final_response)
    
    # Replace the Spanner database and table names below with your own.
    call_agent("List all tables in projects/<PROJECT_ID>/instances/<INSTANCE_ID>/databases/<DATABASE_ID>")
    call_agent("Describe the schema of <TABLE_NAME>")
    call_agent("List the top 5 rows in <TABLE_NAME>")
    

Back to top  [ Previous  RAG Engine  ](../vertex-ai-rag-engine/) [ Next  Vertex AI Search  ](../vertex-ai-search/)

Copyright Google 2025  |  [Terms](//policies.google.com/terms)  |  [Privacy](//policies.google.com/privacy)  |  Manage cookies

Made with [ Material for MkDocs ](https://squidfunk.github.io/mkdocs-material/)

#### Cookie consent

We use cookies to recognize repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find the information they need. With your consent, you're helping us to make our documentation better.

  * Google Analytics 
  * GitHub 



Accept Manage settings

Skip to content 

[ ](../.. "Agent Development Kit")

[ Agent Development Kit ](../.. "Agent Development Kit")

Callback patterns 

Initializing search 




[ adk-python  ](https://github.com/google/adk-python "adk-python") [ adk-js  ](https://github.com/google/adk-js "adk-js") [ adk-go  ](https://github.com/google/adk-go "adk-go") [ adk-java  ](https://github.com/google/adk-java "adk-java")

[ adk-python  ](https://github.com/google/adk-python "adk-python") [ adk-js  ](https://github.com/google/adk-js "adk-js") [ adk-go  ](https://github.com/google/adk-go "adk-go") [ adk-java  ](https://github.com/google/adk-java "adk-java")

  * [ Home  ](../..)

Home 
  * Build Agents  Build Agents 
    * [ Get Started  ](../../get-started/)

Get Started 
      * [ Python  ](../../get-started/python/)
      * [ TypeScript  ](../../get-started/typescript/)
      * [ Go  ](../../get-started/go/)
      * [ Java  ](../../get-started/java/)
    * [ Build your Agent  ](../../tutorials/)

Build your Agent 
      * [ Multi-tool agent  ](../../get-started/quickstart/)
      * [ Agent team  ](../../tutorials/agent-team/)
      * [ Streaming agent  ](../../get-started/streaming/)

Streaming agent 
        * [ Python  ](../../get-started/streaming/quickstart-streaming/)
        * [ Java  ](../../get-started/streaming/quickstart-streaming-java/)
      * [ Visual Builder  ](../../visual-builder/)
      * [ Coding with AI  ](../../tutorials/coding-with-ai/)
      * [ Advanced setup  ](../../get-started/installation/)
    * [ Agents  ](../../agents/)

Agents 
      * [ LLM agents  ](../../agents/llm-agents/)
      * [ Workflow agents  ](../../agents/workflow-agents/)

Workflow agents 
        * [ Sequential agents  ](../../agents/workflow-agents/sequential-agents/)
        * [ Loop agents  ](../../agents/workflow-agents/loop-agents/)
        * [ Parallel agents  ](../../agents/workflow-agents/parallel-agents/)
      * [ Custom agents  ](../../agents/custom-agents/)
      * [ Multi-agent systems  ](../../agents/multi-agents/)
      * [ Agent Config  ](../../agents/config/)
      * [ Models & Authentication  ](../../agents/models/)
    * [ Tools for Agents  ](../../tools/)

Tools for Agents 
      * [ Gemini API tools  ](../../tools/gemini-api/)

Gemini API tools 
        * [ Code Execution  ](../../tools/gemini-api/code-execution/)
        * [ Computer use  ](../../tools/gemini-api/computer-use/)
        * [ Google Search  ](../../tools/gemini-api/google-search/)
      * [ Google Cloud tools  ](../../tools/google-cloud/)

Google Cloud tools 
        * [ Apigee API Hub  ](../../tools/google-cloud/apigee-api-hub/)
        * [ Application Integration  ](../../tools/google-cloud/application-integration/)
        * [ BigQuery  ](../../tools/google-cloud/bigquery/)
        * [ Bigtable  ](../../tools/google-cloud/bigtable/)
        * [ Cloud API Registry  ](../../tools/google-cloud/api-registry/)
        * [ Code Execution with Agent Engine  ](../../tools/google-cloud/code-exec-agent-engine/)
        * [ GKE Code Executor  ](../../tools/google-cloud/gke-code-executor/)
        * [ MCP Toolbox for Databases  ](../../tools/google-cloud/mcp-toolbox-for-databases/)
        * [ RAG Engine  ](../../tools/google-cloud/vertex-ai-rag-engine/)
        * [ Spanner  ](../../tools/google-cloud/spanner/)
        * [ Vertex AI Search  ](../../tools/google-cloud/vertex-ai-search/)
      * [ Third-party tools  ](../../tools/third-party/)

Third-party tools 
        * [ Atlassian  ](../../tools/third-party/atlassian/)
        * [ GitHub  ](../../tools/third-party/github/)
        * [ GitLab  ](../../tools/third-party/gitlab/)
        * [ Hugging Face  ](../../tools/third-party/hugging-face/)
        * [ Linear  ](../../tools/third-party/linear/)
        * [ n8n  ](../../tools/third-party/n8n/)
        * [ Notion  ](../../tools/third-party/notion/)
        * [ PayPal  ](../../tools/third-party/paypal/)
        * [ Qdrant  ](../../tools/third-party/qdrant/)
        * [ Agentic UI (AG-UI)  ](../../tools/third-party/ag-ui/)
      * [ Tool limitations  ](../../tools/limitations/)
    * [ Custom Tools  ](../../tools-custom/)

Custom Tools 
      * Function tools  Function tools 
        * [ Overview  ](../../tools-custom/function-tools/)
        * [ Tool performance  ](../../tools-custom/performance/)
        * [ Action confirmations  ](../../tools-custom/confirmation/)
      * [ MCP tools  ](../../tools-custom/mcp-tools/)
      * [ OpenAPI tools  ](../../tools-custom/openapi-tools/)
      * [ Authentication  ](../../tools-custom/authentication/)
  * Run Agents  Run Agents 
    * [ Agent Runtime  ](../../runtime/)

Agent Runtime 
      * [ Runtime Config  ](../../runtime/runconfig/)
      * [ API Server  ](../../runtime/api-server/)
      * [ Resume Agents  ](../../runtime/resume/)
    * [ Deployment  ](../../deploy/)

Deployment 
      * [ Agent Engine  ](../../deploy/agent-engine/)

Agent Engine 
        * [ Standard deployment  ](../../deploy/agent-engine/deploy/)
        * [ Agent Starter Pack  ](../../deploy/agent-engine/asp/)
        * [ Test deployed agents  ](../../deploy/agent-engine/test/)
      * [ Cloud Run  ](../../deploy/cloud-run/)
      * [ GKE  ](../../deploy/gke/)
    * Observability  Observability 
      * [ Logging  ](../../observability/logging/)
      * [ Cloud Trace  ](../../observability/cloud-trace/)
      * [ BigQuery Agent Analytics  ](../../observability/bigquery-agent-analytics/)
      * [ AgentOps  ](../../observability/agentops/)
      * [ Arize AX  ](../../observability/arize-ax/)
      * [ Freeplay  ](../../observability/freeplay/)
      * [ MLflow  ](../../observability/mlflow/)
      * [ Monocle  ](../../observability/monocle/)
      * [ Phoenix  ](../../observability/phoenix/)
      * [ W&B; Weave  ](../../observability/weave/)
    * [ Evaluation  ](../../evaluate/)

Evaluation 
      * [ Criteria  ](../../evaluate/criteria/)
      * [ User Simulation  ](../../evaluate/user-sim/)
    * [ Safety and Security  ](../../safety/)

Safety and Security 
  * Components  Components 
    * [ Technical Overview  ](../../get-started/about/)
    * [ Context  ](../../context/)

Context 
      * [ Context caching  ](../../context/caching/)
      * [ Context compression  ](../../context/compaction/)
    * [ Sessions & Memory  ](../../sessions/)

Sessions & Memory 
      * Sessions  Sessions 
        * [ Overview  ](../../sessions/session/)
        * [ Rewind sessions  ](../../sessions/rewind/)
      * [ State  ](../../sessions/state/)
      * [ Memory  ](../../sessions/memory/)
      * [ Vertex AI Express Mode  ](../../sessions/express-mode/)
    * [ Callbacks  ](../)

Callbacks 
      * [ Types of callbacks  ](../types-of-callbacks/)
      * Callback patterns  [ Callback patterns  ](./) Table of contents 
        * Design Patterns 
          * 1\. Guardrails & Policy Enforcement 
          * 2\. Dynamic State Management 
          * 3\. Logging and Monitoring 
          * 4\. Caching 
          * 5\. Request/Response Modification 
          * 6\. Conditional Skipping of Steps 
          * 7\. Tool-Specific Actions (Authentication & Summarization Control) 
          * 8\. Artifact Handling 
        * Best Practices for Callbacks 
          * Design Principles 
          * Error Handling 
          * State Management 
          * Reliability 
          * Testing & Documentation 
    * [ Artifacts  ](../../artifacts/)

Artifacts 
    * [ Events  ](../../events/)

Events 
    * [ Apps  ](../../apps/)

Apps 
    * [ Plugins  ](../../plugins/)

Plugins 
      * [ Reflect and retry  ](../../plugins/reflect-and-retry/)
    * [ MCP  ](../../mcp/)

MCP 
    * [ A2A Protocol  ](../../a2a/)

A2A Protocol 
      * [ Introduction to A2A  ](../../a2a/intro/)
      * A2A Quickstart (Exposing)  A2A Quickstart (Exposing) 
        * [ Python  ](../../a2a/quickstart-exposing/)
        * [ Go  ](../../a2a/quickstart-exposing-go/)
      * A2A Quickstart (Consuming)  A2A Quickstart (Consuming) 
        * [ Python  ](../../a2a/quickstart-consuming/)
        * [ Go  ](../../a2a/quickstart-consuming-go/)
    * [ Bidi-streaming (live)  ](../../streaming/)

Bidi-streaming (live) 
      * Bidi-streaming development guide series  Bidi-streaming development guide series 
        * [ Part 1. Intro to streaming  ](../../streaming/dev-guide/part1/)
        * [ Part 2. Sending messages  ](../../streaming/dev-guide/part2/)
        * [ Part 3. Event handling  ](../../streaming/dev-guide/part3/)
        * [ Part 4. Run configuration  ](../../streaming/dev-guide/part4/)
        * [ Part 5. Audio, Images, and Video  ](../../streaming/dev-guide/part5/)
      * [ Streaming Tools  ](../../streaming/streaming-tools/)
      * [ Configuring Bidi-streaming behavior  ](../../streaming/configuration/)
    * Grounding  Grounding 
      * [ Understanding Google Search Grounding  ](../../grounding/google_search_grounding/)
      * [ Understanding Vertex AI Search Grounding  ](../../grounding/vertex_ai_search_grounding/)
  * Reference  Reference 
    * [ Release Notes  ](../../release-notes/)
    * [ API Reference  ](../../api-reference/)

API Reference 
      * [ Python ADK  ](../../api-reference/python/)
      * [ Typescript ADK  ](../../api-reference/typescript/)
      * [ Go ADK  ](https://pkg.go.dev/google.golang.org/adk)
      * [ Java ADK  ](../../api-reference/java/)
      * [ CLI Reference  ](../../api-reference/cli/)
      * [ Agent Config Reference  ](../../api-reference/agentconfig/)
      * [ REST API  ](../../api-reference/rest/)
    * [ Community Resources  ](../../community/)
    * [ Contributing Guide  ](../../contributing-guide/)



Table of contents 

  * Design Patterns 
    * 1\. Guardrails & Policy Enforcement 
    * 2\. Dynamic State Management 
    * 3\. Logging and Monitoring 
    * 4\. Caching 
    * 5\. Request/Response Modification 
    * 6\. Conditional Skipping of Steps 
    * 7\. Tool-Specific Actions (Authentication & Summarization Control) 
    * 8\. Artifact Handling 
  * Best Practices for Callbacks 
    * Design Principles 
    * Error Handling 
    * State Management 
    * Reliability 
    * Testing & Documentation 



  1. [ Components  ](../../get-started/about/)
  2. [ Callbacks  ](../)

[ ](https://github.com/google/adk-docs/edit/main/docs/callbacks/design-patterns-and-best-practices.md "Edit this page") [ ](https://github.com/google/adk-docs/raw/main/docs/callbacks/design-patterns-and-best-practices.md "View source of this page")

# Design Patterns and Best Practices for Callbacks¶

Callbacks offer powerful hooks into the agent lifecycle. Here are common design patterns illustrating how to leverage them effectively in ADK, followed by best practices for implementation.

## Design Patterns¶

These patterns demonstrate typical ways to enhance or control agent behavior using callbacks:

### 1\. Guardrails & Policy Enforcement¶

**Pattern Overview:** Intercept requests before they reach the LLM or tools to enforce rules.

**Implementation:** \- Use `before_model_callback` to inspect the `LlmRequest` prompt \- Use `before_tool_callback` to inspect tool arguments \- If a policy violation is detected (e.g., forbidden topics, profanity): \- Return a predefined response (`LlmResponse` or `dict`/`Map`) to block the operation \- Optionally update `context.state` to log the violation

**Example Use Case:** A `before_model_callback` checks `llm_request.contents` for sensitive keywords and returns a standard "Cannot process this request" `LlmResponse` if found, preventing the LLM call.

### 2\. Dynamic State Management¶

**Pattern Overview:** Read from and write to session state within callbacks to make agent behavior context-aware and pass data between steps.

**Implementation:** \- Access `callback_context.state` or `tool_context.state` \- Modifications (`state['key'] = value`) are automatically tracked in the subsequent `Event.actions.state_delta` \- Changes are persisted by the `SessionService`

**Example Use Case:** An `after_tool_callback` saves a `transaction_id` from the tool's result to `tool_context.state['last_transaction_id']`. A later `before_agent_callback` might read `state['user_tier']` to customize the agent's greeting.

### 3\. Logging and Monitoring¶

**Pattern Overview:** Add detailed logging at specific lifecycle points for observability and debugging.

**Implementation:** \- Implement callbacks (e.g., `before_agent_callback`, `after_tool_callback`, `after_model_callback`) \- Print or send structured logs containing: \- Agent name \- Tool name \- Invocation ID \- Relevant data from the context or arguments

**Example Use Case:** Log messages like `INFO: [Invocation: e-123] Before Tool: search_api - Args: {'query': 'ADK'}`.

### 4\. Caching¶

**Pattern Overview:** Avoid redundant LLM calls or tool executions by caching results.

**Implementation Steps:** 1\. **Before Operation:** In `before_model_callback` or `before_tool_callback`: \- Generate a cache key based on the request/arguments \- Check `context.state` (or an external cache) for this key \- If found, return the cached `LlmResponse` or result directly

  1. **After Operation:** If cache miss occurred:
  2. Use the corresponding `after_` callback to store the new result in the cache using the key



**Example Use Case:** `before_tool_callback` for `get_stock_price(symbol)` checks `state[f"cache:stock:{symbol}"]`. If present, returns the cached price; otherwise, allows the API call and `after_tool_callback` saves the result to the state key.

### 5\. Request/Response Modification¶

**Pattern Overview:** Alter data just before it's sent to the LLM/tool or just after it's received.

**Implementation Options:** \- **`before_model_callback`:** Modify `llm_request` (e.g., add system instructions based on `state`) \- **`after_model_callback`:** Modify the returned `LlmResponse` (e.g., format text, filter content) \- **`before_tool_callback`:** Modify the tool `args` dictionary (or Map in Java) \- **`after_tool_callback`:** Modify the `tool_response` dictionary (or Map in Java)

**Example Use Case:** `before_model_callback` appends "User language preference: Spanish" to `llm_request.config.system_instruction` if `context.state['lang'] == 'es'`.

### 6\. Conditional Skipping of Steps¶

**Pattern Overview:** Prevent standard operations (agent run, LLM call, tool execution) based on certain conditions.

**Implementation:** \- Return a value from a `before_` callback to skip the normal execution: \- `Content` from `before_agent_callback` \- `LlmResponse` from `before_model_callback` \- `dict` from `before_tool_callback` \- The framework interprets this returned value as the result for that step

**Example Use Case:** `before_tool_callback` checks `tool_context.state['api_quota_exceeded']`. If `True`, it returns `{'error': 'API quota exceeded'}`, preventing the actual tool function from running.

### 7\. Tool-Specific Actions (Authentication & Summarization Control)¶

**Pattern Overview:** Handle actions specific to the tool lifecycle, primarily authentication and controlling LLM summarization of tool results.

**Implementation:** Use `ToolContext` within tool callbacks (`before_tool_callback`, `after_tool_callback`):

  * **Authentication:** Call `tool_context.request_credential(auth_config)` in `before_tool_callback` if credentials are required but not found (e.g., via `tool_context.get_auth_response` or state check). This initiates the auth flow.
  * **Summarization:** Set `tool_context.actions.skip_summarization = True` if the raw dictionary output of the tool should be passed back to the LLM or potentially displayed directly, bypassing the default LLM summarization step.



**Example Use Case:** A `before_tool_callback` for a secure API checks for an auth token in state; if missing, it calls `request_credential`. An `after_tool_callback` for a tool returning structured JSON might set `skip_summarization = True`.

### 8\. Artifact Handling¶

**Pattern Overview:** Save or load session-related files or large data blobs during the agent lifecycle.

**Implementation:** \- **Saving:** Use `callback_context.save_artifact` / `await tool_context.save_artifact` to store data: \- Generated reports \- Logs \- Intermediate data \- **Loading:** Use `load_artifact` to retrieve previously stored artifacts \- **Tracking:** Changes are tracked via `Event.actions.artifact_delta`

**Example Use Case:** An `after_tool_callback` for a "generate_report" tool saves the output file using `await tool_context.save_artifact("report.pdf", report_part)`. A `before_agent_callback` might load a configuration artifact using `callback_context.load_artifact("agent_config.json")`.

## Best Practices for Callbacks¶

### Design Principles¶

**Keep Focused:** Design each callback for a single, well-defined purpose (e.g., just logging, just validation). Avoid monolithic callbacks.

**Mind Performance:** Callbacks execute synchronously within the agent's processing loop. Avoid long-running or blocking operations (network calls, heavy computation). Offload if necessary, but be aware this adds complexity.

### Error Handling¶

**Handle Errors Gracefully:** \- Use `try...except/catch` blocks within your callback functions \- Log errors appropriately \- Decide if the agent invocation should halt or attempt recovery \- Don't let callback errors crash the entire process

### State Management¶

**Manage State Carefully:** \- Be deliberate about reading from and writing to `context.state` \- Changes are immediately visible within the _current_ invocation and persisted at the end of the event processing \- Use specific state keys rather than modifying broad structures to avoid unintended side effects \- Consider using state prefixes (`State.APP_PREFIX`, `State.USER_PREFIX`, `State.TEMP_PREFIX`) for clarity, especially with persistent `SessionService` implementations

### Reliability¶

**Consider Idempotency:** If a callback performs actions with external side effects (e.g., incrementing an external counter), design it to be idempotent (safe to run multiple times with the same input) if possible, to handle potential retries in the framework or your application.

### Testing & Documentation¶

**Test Thoroughly:** \- Unit test your callback functions using mock context objects \- Perform integration tests to ensure callbacks function correctly within the full agent flow

**Ensure Clarity:** \- Use descriptive names for your callback functions \- Add clear docstrings explaining their purpose, when they run, and any side effects (especially state modifications)

**Use Correct Context Type:** Always use the specific context type provided (`CallbackContext` for agent/model, `ToolContext` for tools) to ensure access to the appropriate methods and properties.

By applying these patterns and best practices, you can effectively use callbacks to create more robust, observable, and customized agent behaviors in ADK.

Back to top  [ Previous  Types of callbacks  ](../types-of-callbacks/) [ Next  Artifacts  ](../../artifacts/)

Copyright Google 2025  |  [Terms](//policies.google.com/terms)  |  [Privacy](//policies.google.com/privacy)  |  Manage cookies

Made with [ Material for MkDocs ](https://squidfunk.github.io/mkdocs-material/)

#### Cookie consent

We use cookies to recognize repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find the information they need. With your consent, you're helping us to make our documentation better.

  * Google Analytics 
  * GitHub 



Accept Manage settings
